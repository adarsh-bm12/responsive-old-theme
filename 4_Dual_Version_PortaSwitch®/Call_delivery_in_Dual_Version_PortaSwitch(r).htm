<?xml version="1.0" encoding="utf-8" ?>

<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head>

  <script type="text/javascript" language="JavaScript">
    //<![CDATA[
    function reDo() {
      if (innerWidth != origWidth || innerHeight != origHeight)
        location.reload();
    }
    if ((parseInt(navigator.appVersion) == 4) && (navigator.appName == "Netscape")) {
      origWidth = innerWidth;
      origHeight = innerHeight;
      onresize = reDo;
    }
    onerror = null;
  //]]>
  </script>
  <style type="text/css">/*<![CDATA[*/

    < !-- div.WebHelpPopupMenu {
      position: absolute;
      left: 0px;
      top: 0px;
      z-index: 4;
      visibility: hidden;
    }

    p.WebHelpNavBar {
      text-align: right;
    }

    -->
  
/*]]>*/</style>

  <script type="text/javascript">//<![CDATA[

    gRootRelPath = "..";
    gCommonRootRelPath = "..";
    gTopicId = "5.3";
  
//]]></script>

  <script type="text/javascript" src="../template/scripts/rh.min.js"></script>
  <script type="text/javascript" src="../template/scripts/common.min.js"></script>
  <script type="text/javascript" src="../template/scripts/topic.min.js"></script>
  <script type="text/javascript" src="../template/scripts/topicwidgets.min.js"></script>
<script type="text/javascript" src="../whxdata/projectsettings.js"></script>
  <link rel="stylesheet" type="text/css" href="../template/styles/topic.min.css"/>
  <link rel="stylesheet" type="text/css" href="../template/Port/topicheader.css"/>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <meta name="generator" content="Adobe RoboHelp 2019"/>
  <title>Call delivery in Dual Version PortaSwitch®</title>
  <meta name="topic-status" content="Draft"/>

  <meta charset="UTF-8"/>
  <title>Call delivery in Dual Version PortaSwitch®</title>
  <meta name="generator" content="Adobe RoboHelp 2019"/>
  <link rel="stylesheet" href="../assets/css/new_css.css"/>
  <link rel="stylesheet" href="../assets/css/Call delivery in Dual Version PortaSwitch.css"/>
</head>

<body>
  <div class="topic-header rh-hide" id="rh-topic-header" onclick="rh._.goToFullLayout()">
    <div class="logo">
    </div>
    <div class="nav">
      <div class="title" title="Call delivery in Dual Version PortaSwitch®">
        <span>Call delivery in Dual Version PortaSwitch®</span>
      </div>
      <div class="gotohome" title="Click here to see this page in full context">
        <span>Click here to see this page in full context</span>
      </div>
    </div>
  </div>
  <div class="topic-header-shadow rh-hide" id="rh-topic-header-shadow"></div>



  <div>
    <h2 class="Heading2"><a id="Call_delivery_in_Dual_Version_PortaSwitch®"></a>Call delivery in Dual Version PortaSwitch®</h2>
    <p>For the successful operation of Dual Version PortaSwitch®, it is essential that customers do not notice being moved from one system to another. That is, if John Doe is already in the target system, he must be able to make and receive calls as if nothing
      has changed.</p>
    <p>To deliver calls to accounts in either system PortaSwitch® uses the dispatching SBC. This is a dedicated PortaSIP® node that operates as the inter-system proxy and dispatches call initiation requests across systems. It operates in high-availability
      mode and presents a single point of entry to both your termination partners and your wholesale, SIP trunking, residential and other customers.</p>
    <h4 class="Heading4"><a id="Usage_scenarios"></a>Usage scenarios</h4>
    <p>Let’s take a closer look at how PortaSwitch® processes calls for John: first, when his record is still provisioned in source system A and then, when it is moved to target system B. To make and receive calls, the dispatching SBC’s IP address is used
      to register John’s phone.</p>
    <h5><em><a id="Source_system_–_outgoing_calls"></a>Source system – outgoing calls</em></h5>
    <p>Let’s say John calls his friend Harry in the UK.</p>
    <p> </p>
    <p><img alt="CalldeliveryinDualVersionPortaSwitch-Image-01" src="../assets/images/Call delivery in Dual Version PortaSwitch_files/image1.png" data-rhwidget="Basic" data-popupimage="../assets/images/Call delivery in Dual Version PortaSwitch_files/image1.png" class="popup-image-thumbnail" width="750"/></p>
    <p> </p>
    <ol class="List0" data-start="1" xmlns="">
      <li>
        <p class="ListParagraph">John’s phone sends an INVITE request to the dispatching SBC (<strong><span style="color:#ff0000;">1</span></strong>).</p>
      </li>
      <li>
        <p class="ListParagraph">The dispatching SBC searches for John’s account in the database and detects that it belongs to system A.</p>
      </li>
      <li>
        <p class="ListParagraph">The dispatching SBC routes the INVITE request to PortaSIP® on system A (<strong><span style="color:#ff0000;">2</span></strong>).</p>
      </li>
      <li>
        <p class="ListParagraph">Within system A, PortaSIP® sends the authorization request to PortaBilling®.</p>
      </li>
      <li>
        <p class="ListParagraph">PortaBilling® authorizes the call and provides PortaSIP® with the routing results.</p>
      </li>
      <li>
        <p class="ListParagraph">PortaSIP® sends the call to the vendor to establish the call with Harry (<strong><span style="color:#ff0000;">3</span></strong>).</p>
      </li>
      <li>
        <p class="ListParagraph">When the call finishes, PortaSIP® sends accounting information to PortaBilling® to calculate the charges and produce xDRs.</p>
      </li>
    </ol>
    <h5><em><a id="Source_system_–_incoming_calls"></a>Source system – incoming calls</em></h5>
    <p>Consider this example when John receives a call from abroad.</p>
    <p> </p>
    <p><img alt="CalldeliveryinDualVersionPortaSwitch-Image-02" src="../assets/images/Call delivery in Dual Version PortaSwitch_files/image2.png" data-rhwidget="Basic" data-popupimage="../assets/images/Call delivery in Dual Version PortaSwitch_files/image2.png" class="popup-image-thumbnail" width="750"/></p>
    <p> </p>
    <ol>
      <li>
        <p class="ListParagraph">The vendor receives the call from the PSTN network and sends it to the dispatching SBC (<strong><span style="color:#ff0000;">1</span></strong>).</p>
      </li>
      <li>
        <p class="ListParagraph">The dispatching SBC searches the database for the DID number that matches the destination number.</p>
      </li>
      <li>
        <p class="ListParagraph">The dispatching SBC detects that the destination number corresponds to John’s account and that it belongs to system A.</p>
      </li>
      <li>
        <p class="ListParagraph">The dispatching SBC routes the call to system A’s PortaSIP® (<strong><span style="color:#ff0000;">2</span></strong>).</p>
      </li>
      <li>
        <p class="ListParagraph">PortaSIP® sends an authorization request to the respective PortaBilling®.</p>
      </li>
      <li>
        <p class="ListParagraph">PortaBilling® authorizes the call and detects that the destination number matches the local account so it returns the result to PortaSIP®.</p>
      </li>
      <li>
        <p class="ListParagraph">PortaSIP® checks that the account’s IP phone is registered via the dispatching SBC, and therefore, it sends the call to the dispatching SBC (<strong><span style="color:#ff0000;">3</span></strong>).</p>
      </li>
      <li>
        <p class="ListParagraph">When the dispatching SBC delivers the call to John’s phone (<strong><span style="color:#ff0000;">4</span></strong>) it starts ringing.</p>
      </li>
      <li>
        <p class="ListParagraph">When the call ends, PortaSIP® in system A sends accounting information to PortaBilling® to calculate the charges and create an xDR for John.</p>
      </li>
    </ol>
    <h5><em><a id="Target_system_–_outgoing_calls"></a>Target system – outgoing calls</em></h5>
    <p>The administrator has transferred John’s record to the target system.</p>
    <p>So now when John makes another call to his friend Harry in the UK, the following occurs:</p>
    <p> </p>
    <p><img alt="CalldeliveryinDualVersionPortaSwitch-Image-03" src="../assets/images/Call delivery in Dual Version PortaSwitch_files/image3.png" data-rhwidget="Basic" data-popupimage="../assets/images/Call delivery in Dual Version PortaSwitch_files/image3.png" class="popup-image-thumbnail" width="750"/></p>
    <p> </p>
    <ol>
      <li>
        <p class="ListParagraph">The call request from John’s phone arrives to the dispatching SBC (<strong><span style="color:#ff0000;">1</span></strong>).</p>
      </li>
      <li>
        <p class="ListParagraph">The dispatching SBC searches John’s account in the database and detects that it is provisioned in system B.</p>
      </li>
      <li>
        <p class="ListParagraph">The dispatching SBC routes the call to system B’s PortaSIP® (<strong><span style="color:#ff0000;">2</span></strong>).</p>
      </li>
      <li>
        <p class="ListParagraph">PortaSIP® sends the authorization request to the respective PortaBilling®.</p>
      </li>
      <li>
        <p class="ListParagraph">PortaBilling® authorizes the call and provides PortaSIP® with the routing results.</p>
      </li>
      <li>
        <p class="ListParagraph">PortaSIP® sends the call to the vendor and establishes the call with Harry (<strong><span style="color:#ff0000;">3</span></strong>).</p>
      </li>
      <li>
        <p class="ListParagraph">When the call ends, PortaSIP® sends accounting information to PortaBilling® to calculate the charges and produce xDRs.</p>
      </li>
    </ol>
    <h5><em><a id="Target_system_–_incoming_calls"></a>Target system – incoming calls</em></h5>
    <p>When Jane dials John’s number, the following occurs:</p>
    <p> </p>
    <p><img alt="CalldeliveryinDualVersionPortaSwitch-Image-04" src="../assets/images/Call delivery in Dual Version PortaSwitch_files/image4.png" data-rhwidget="Basic" data-popupimage="../assets/images/Call delivery in Dual Version PortaSwitch_files/image4.png" class="popup-image-thumbnail" width="750"/></p>
    <p> </p>
    <ol>
      <li>
        <p class="ListParagraph">The vendor receives the call from the PSTN network and sends it to the dispatching SBC (<strong><span style="color:#ff0000;">1</span></strong>).</p>
      </li>
      <li>
        <p class="ListParagraph">The dispatching SBC searches the database for the DID number that matches the destination number.</p>
      </li>
      <li>
        <p class="ListParagraph">The dispatching SBC determines that the destination number corresponds to John’s account and is provisioned in system B.</p>
      </li>
      <li>
        <p class="ListParagraph">The dispatching SBC routes the call request to system B’s PortaSIP® (<strong><span style="color:#ff0000;">2</span></strong>).</p>
      </li>
      <li>
        <p class="ListParagraph">PortaSIP® sends the authorization request to the respective PortaBilling®.</p>
      </li>
      <li>
        <p class="ListParagraph">PortaBilling® authorizes the call and notifies PortaSIP® that the call is intended for the local account.</p>
      </li>
      <li>
        <p class="ListParagraph">PortaSIP® checks that John’s IP phone is registered via the dispatching SBC, and therefore sends the call to the dispatching SBC (<strong><span style="color:#ff0000;">3</span></strong>).</p>
      </li>
      <li>
        <p class="ListParagraph">The dispatching SBC delivers the call to John’s phone and John and Jane begin their conversation (<strong><span style="color:#ff0000;">4</span></strong>).</p>
      </li>
      <li>
        <p class="ListParagraph">Once the call ends, PortaSIP® in system B sends accounting information to PortaBilling® to calculate the charges and create an xDR for John.</p>
      </li>
    </ol>
    <h4 class="Heading4"><a id="Inter-system_calling"></a>Inter-system calling</h4>
    <p>When customers are moved from one system to another, they must be reachable both from the external network and from the previous system. One way to deliver calls to such customers is to use the PSTN network. However, this is impractical since it adds
      hops in the call path and imposes additional charges.</p>
    <p>To optimize call delivery and eliminate excessive charges, Dual Version PortaSwitch® has the inter-system routing mechanism as the direct path for calls throughout the whole network.</p>
    <p>Calls between systems are delivered using special rate codes. These codes represent the billing environments of either system and are derived from their unique IDs. This distinguishes this routing system from intra-system routing.</p>
    <p> </p>
    <p><img alt="CalldeliveryinDualVersionPortaSwitch-Image-05" src="../assets/images/Call delivery in Dual Version PortaSwitch_files/image5.png" data-rhwidget="Basic" data-popupimage="../assets/images/Call delivery in Dual Version PortaSwitch_files/image5.png" class="popup-image-thumbnail" width="750"/></p>
    <p> </p>
    <p>Thus, if Jane, from source system A, calls Mary, who is already in the target system B, the following occurs:</p>
    <ul class="List1" data-start="1" xmlns="">
      <li>
        <p class="ListParagraph">The call from Jane’s phone arrives to the dispatching SBC (<strong><span style="color:#ff0000;">1</span></strong>)</p>
      </li>
      <li>
        <p class="ListParagraph">The dispatching SBC sends a call request to PortaSIP® at the source system A for processing (<strong><span style="color:#ff0000;">2</span></strong>).</p>
      </li>
      <li>
        <p class="ListParagraph">PortaSIP® in system A authorizes the call in PortaBilling®.</p>
      </li>
      <li>
        <p class="ListParagraph">PortaBilling® detects that the destination number belongs to the account that has been moved to the target system and therefore instructs PortaSIP® to send the call to the system B.</p>
      </li>
      <li>
        <p class="ListParagraph">PortaSIP® on the system A routes the call to PortaSIP® on the system B, bypassing the dispatching SBC (<strong><span style="color:#ff0000;">3</span></strong>).</p>
      </li>
      <li>
        <p class="ListParagraph">Upon call authorization in the system B’s PortaBilling®, PortaSIP® sends the call to the dispatching SBC (<strong><span style="color:#ff0000;">4</span></strong>), which delivers the call to Mary’s phone (<strong><span style="color:#ff0000;">5</span></strong>).</p>
      </li>
      <li>
        <p class="ListParagraph">When the call finishes, each PortaSIP® instance sends accounting requests to PortaBilling®. Then PortaBilling® in system A creates an xDR for Jane’s account while PortaBilling® in system B creates an xDR for Mary’s account.</p>
      </li>
    </ul>
    <h4 class="Heading4"><a id="Fallback_call_delivery"></a>Fallback call delivery</h4>
    <p>To find which system to route an incoming call to in Dual Version PortaSwitch®, the dispatching SBC matches first the destination number and then the source number against the account/DID list in the database.</p>
    <p>If the dispatching SBC cannot find the target system for some reason (e.g. there is no record in the database to match the destination number), it sends the call to a fallback system. In that system, PortaSIP® authorizes the call in PortaBilling®
      and receives the correct routing to deliver the call to the recipient. The target system is the fallback system by default.</p>
    <p>You can configure a fallback system for the dispatching SBC to send calls. For example, if you have just deployed Dual Version PortaSwitch® and haven’t yet migrated customers to the target system, define the source system as the fallback one. Select
      a billing environment from the source system in the <strong>ForwardingRegistry.fallback_env </strong>option on the Configuration server.</p>
    <p> </p>
    <p><img alt="Fallback system config" src="../assets/images/Call delivery in Dual Version PortaSwitch_files/image6.png" data-rhwidget="Basic" data-popupimage="../assets/images/Call delivery in Dual Version PortaSwitch_files/image6.png" class="popup-image-thumbnail" width="1000"/></p>
    <p> </p>
    <p>Then when the dispatching SBC cannot identify where to dispatch an incoming request, it routes this request to the source system for further processing.</p>
    <p>Fallback call delivery increases the call success rate in Dual Version PortaSwitch® and therefore improves customer experience.</p>
  </div>

</body></html>